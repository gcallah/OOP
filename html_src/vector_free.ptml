<!DOCTYPE html>
<html>
    <head>
<!--include head.txt -->
        <title>
            17. Vector and Free Store
        </title>
<!--include googleAnalyticsScript.txt -->
    </head>

    <body>
        <div class="wrapper">
<!--include navbar.txt -->
            <div id="content">
                <h1>
                    17. Vector and Free Store
                </h1>

                <p class="leadquote">
                "Use <code>vector</code> as the default."
                -- Alex Stepanov
                </p>

                <details>
                    <summary class="sum1">
                    17.1 Introduction
                    </summary>
                    <figure>
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a6/Vector_components_and_base_change.svg/400px-Vector_components_and_base_change.svg.png"
                        width="20%">
                        <figcaption>
                        </figcaption>
                    </figure>

                    <p>
                        The most useful class in the standard C++ library is
                        <code>vector</code>.
                        We are going to undertake an adventure: we are going to
                        try to understand how <code>vector</code> was gradually
                        built to what we have today, why it was so designed,
                        and along the way we will gain some understanding of
                        how we might create our own container. We will also
                        gain an understanding of how computer programs work at
                        a deeper level than we have encountered before.
                    </p>

                    <p>
                        Why bother with all of these details? The reason is, if
                        we want to become true software professionals, we must
                        understand how our languages use the underlying
                        hardware!
                    </p>

                </details>

                <details>
                    <summary class="sum1">
                    17.2 vector basics
                    </summary>
                    <p>
                      <PRE>
                        <code>
vector&lt;double&gt; age(4); <span class="comment">// a vector with 4 elements of type double</span>
age[0]=0.33;
age[1]=22.0;
age[2]=27.2;
age[3]=54.2;
                        </code>
                      </PRE>
                      <br>
                      <figure>
                          <img src="graphics/Chap17Diag1.png" width="40%">
                      </figure>
                    </p>
                    <br>
                    <p>
                      Elements of <code>age</code> are numbered
                      <code>0</code> to <code>age.size()-1</code>.
                      <br>
                      Defining a fixed-size data structure,
                      <br>
                      <PRE>
                        <code>
class vector {
int size, age0, age1, age2, age3;
// . . .
};
                        </code>
                      </PRE>
                      <br>
                      <figure>
                          <img src="graphics/Chap17Diag2.png" width="40%">
                      </figure>
                    </p>
                    <br>
                    <p>
                      Adding an element with <code>push_back()</code> becomes
                      difficult as defined <code>vector</code> has fixed
                      number of elements.
                      <br>
                      We need a data member that points to the set of elements
                      so that it points to different set of elements
                      when more space is needed.
                      <br>
                      A <code>pointer</code> holds an address and is
                      distinguished by the suffix <code>*</code>
                      meaning "pointer to <code>double</code>".
                      <PRE>
                        <code>
<span class="comment">// a very simplified vector of doubles (like vector&lt;double&gt;)</span>
class vector {
int sz; <span class="comment">// the size</span>
double* elem; <span class="comment">// pointer to the first element (of type double)</span>
public:
vector(int s); <span class="comment">// constructor: allocate s doubles,</span>
<span class="comment">// let elem point to them</span>
<span class="comment">// store s in sz</span>
int size() const { return sz; } <span class="comment">// the current size</span>
};
                        </code>
                      </PRE>
                    </p>
                </details>

                <details>
                    <summary class="sum1">
                    17.3 Memory, addresses, and pointers
                    </summary>
                    <p>
                      An <code>address</code> is a "number that
                      indicates a location in memory".
                      <br>
                      <br>
                      A megabyte of memory can be visualized as following,
                      <figure>
                          <img src="graphics/Chap17Diag3.png" width="40%">
                      </figure>
                      <br>
                      <br>
                      <PRE>
                          <code>
int var = 17;
                          </code>
                      </PRE>
                    </p>
                    <p>
                      Here, an "int-size" piece of memory for
                      var is set aside and value 17 is put in memory.
                    </p>
                    <br>
                    <p>
                      <PRE>
<code>
int* ptr = &var; <span class="comment">// ptr holds the address of var</span>
</code>
                      </PRE>
                    </p>

                    <p>
                      The type needed to hold the address of an
                      <code>int</code> is “pointer to int” or
                      an “int pointer” and the notation is <code>int*</code>.
                      <br>
                      <br>
                      The “address of” operator, unary <code>&</code>,
                      is used to get the address of an object.
                      So, if <code>var</code> happens to start at address
                      <code>4096</code>, <code>ptr</code> will hold
                      the value <code>4096</code>:
                      <figure>
                          <img src="graphics/Chap17Diag4.png" width="40%">
                      </figure>
                    </p>
                    <br>
                    <p>
                      Each type has a corresponding pointer type.
                      <PRE>
                        <code>
int x = 17;
int* pi = &x; <span class="comment">// pointer to int</span>
double e = 2.71828;
double* pd = &e; <span class="comment">// pointer to double</span>
                        </code>
                      </PRE>
                    </p>
                    <br>
                    <p>
                      To see value of the object pointed to,
                      <PRE>
                        <code>
cout &lt;&lt; "pi==" &lt;&lt; pi &lt;&lt; "; contents of pi==" &lt;&lt; *pi &lt;&lt; "\n";
cout &lt;&lt; "pd==" &lt;&lt; pd &lt;&lt; "; contents of pd==" &lt;&lt; *pd &lt;&lt; "\n";
                        </code>
                      </PRE>
                    </p>
                    <p>
                      The output for <code>*pi</code> will be the integer
                      <code>17</code> and the output for <code>*pd</code>
                      will be the double <code>2.71828</code>.
                      <br>
                      The output for pi and pd will vary depending on
                      where the compiler allocated our variables x and e in
                      memory.
                    </p>
                    <br>
                    <p>
                      The contents of operator can also be used on the
                      left-hand side of an assignment:
                      <PRE>
                        <code>
*pi = 27; <span class="comment">// OK: you can assign 27 to the int pointed to by pi</span>
*pd = 3.14159; <span class="comment">// OK: you can assign 3.14159 to the double pointed to by pd</span>
*pd = *pi; <span class="comment">// OK: you can assign an int (*pi) to a double (*pd)</span>
                        </code>
                      </PRE>
                    </p>
                    <br>
                    <p>
                      <code>int</code> provides the
                      operations suitable for integers.
                      <br>
                      A pointer type provides the operations suitable
                      for addresses.
                      <PRE>
                        <code>
int i = pi; <span class="comment">// error: can’t assign an int* to an int</span>
pi = 7; <span class="comment">// error: can’t assign an int to an int*</span>
                        </code>
                      </PRE>
                    </p>
                    <br>
                    <p>
                      Also, a pointer to <code>char</code>
                      a <code>char*</code>) is not a pointer
                      to <code>int</code> (an <code>int*</code>):
                      <PRE>
                        <code>
char* pc = pi; <span class="comment">// error: can’t assign an int* to a char*</span>
pi = pc; <span class="comment">// error: can’t assign a char* to an int*</span>
                        </code>
                      </PRE>
                    </p>
                    <br>
                    <p>
                      Why is it an error?
                      <PRE>
                        <code>
char ch1 = 'a';
char ch2 = 'b';
char ch3 = 'c';
char ch4 = 'd';
int* pi = &ch3; <span class="comment">// point to ch3, a char-size piece of memory</span>
<span class="comment">// error: we cannot assign a char* to an int*</span>
<span class="comment">// but let’s pretend we could</span>
*pi = 12345; <span class="comment">// write to an int-size piece of memory</span>
*pi = 67890;
                        </code>
                      </PRE>
                    </p>
                    <p>
                      If the compiler would have allowed the code,
                      <code>12345</code> would be written to the memory
                      starting at <code>&ch3</code>.
                      <br>
                      Then the next assignment <code>*pi=67890</code> would
                      place <code>67890</code> in some completely
                      different part of memory.
                      <br>
                      <br>
                      <i>
                        Thats why our aim is always to work at
                        highest level of abstraction.
                      </i>
                    </p>
                    <details>
                        <summary class="sum2">
                        17.3.1 The size of operator
                        </summary>
                        <figure>
                            <img src="" width="40%">
                            <figcaption>
                            </figcaption>
                        </figure>
                        <p>
                        </p>
                    </details>

                </details>

                <details>
                    <summary class="sum1">
                    17.4 Free store and pointers
                    </summary>
                    <figure>
                        <img src="" width="40%">
                        <figcaption>
                        </figcaption>
                    </figure>
                    <p>
                    </p>
                    <details>
                        <summary class="sum2">
                        17.4.1 Free-store allocation
                        </summary>
                        <figure>
                            <img src="" width="40%">
                            <figcaption>
                            </figcaption>
                        </figure>
                        <p>
                        </p>
                    </details>

                    <details>
                        <summary class="sum2">
                        17.4.2 Access through pointers
                        </summary>
                        <figure>
                            <img src="" width="40%">
                            <figcaption>
                            </figcaption>
                        </figure>
                        <p>
                        </p>
                    </details>

                    <details>
                        <summary class="sum2">
                        17.4.3 Ranges
                        </summary>
                        <figure>
                            <img src="" width="40%">
                            <figcaption>
                            </figcaption>
                        </figure>
                        <p>
                        </p>
                    </details>

                    <details>
                        <summary class="sum2">
                        17.4.4 Initialization
                        </summary>
                        <figure>
                            <img src="" width="40%">
                            <figcaption>
                            </figcaption>
                        </figure>
                        <p>
                        </p>
                    </details>

                    <details>
                        <summary class="sum2">
                        17.4.5 The null pointer
                        </summary>
                        <figure>
                            <img src="" width="40%">
                            <figcaption>
                            </figcaption>
                        </figure>
                        <p>
                        </p>
                    </details>

                    <details>
                        <summary class="sum2">
                        17.4.6 Free-store deallocation
                        </summary>
                        <figure>
                            <img src="" width="40%">
                            <figcaption>
                            </figcaption>
                        </figure>
                        <p>
                        </p>
                    </details>

                </details>

                <details>
                    <summary class="sum1">
                    17.5 Destructors
                    </summary>
                    <figure>
                        <img src="" width="40%">
                        <figcaption>
                        </figcaption>
                    </figure>
                    <p>
                    </p>
                    <details>
                        <summary class="sum2">
                        17.5.1 Generated destructors
                        </summary>
                        <figure>
                            <img src="" width="40%">
                            <figcaption>
                            </figcaption>
                        </figure>
                        <p>
                        </p>
                    </details>

                    <details>
                        <summary class="sum2">
                        17.5.2 Destructors and free store
                        </summary>
                        <figure>
                            <img src="" width="40%">
                            <figcaption>
                            </figcaption>
                        </figure>
                        <p>
                        </p>
                    </details>

                </details>

                <details>
                    <summary class="sum1">
                    17.6 Access to elements
                    </summary>
                    <figure>
                        <img src="" width="40%">
                        <figcaption>
                        </figcaption>
                    </figure>
                    <p>
                    </p>
                </details>

                <details>
                    <summary class="sum1">
                    17.7 Pointers to class objects
                    </summary>
                    <figure>
                        <img src="" width="40%">
                        <figcaption>
                        </figcaption>
                    </figure>
                    <p>
                    </p>
                </details>

                <details>
                    <summary class="sum1">
                    17.8 Messing with types: void* and casts
                    </summary>
                    <figure>
                        <img src="" width="40%">
                        <figcaption>
                        </figcaption>
                    </figure>
                    <p>
                    </p>
                </details>

                <details>
                    <summary class="sum1">
                    17.9 Pointers and references
                    </summary>
                    <figure>
                        <img src="" width="40%">
                        <figcaption>
                        </figcaption>
                    </figure>
                    <p>
                    </p>
                    <details>
                        <summary class="sum2">
                        17.9.1 Pointer and reference parameters
                        </summary>
                        <figure>
                            <img src="" width="40%">
                            <figcaption>
                            </figcaption>
                        </figure>
                        <p>
                        </p>
                    </details>

                    <details>
                        <summary class="sum2">
                        17.9.2 Pointers, references, and inheritance
                        </summary>
                        <figure>
                            <img src="" width="40%">
                            <figcaption>
                            </figcaption>
                        </figure>
                        <p>
                        </p>
                    </details>

                    <details>
                        <summary class="sum2">
                        17.9.3 An example: lists
                        </summary>
                        <figure>
                            <img src="" width="40%">
                            <figcaption>
                            </figcaption>
                        </figure>
                        <p>
                        </p>
                    </details>

                    <details>
                        <summary class="sum2">
                        17.9.4 List operations
                        </summary>
                        <figure>
                            <img src="" width="40%">
                            <figcaption>
                            </figcaption>
                        </figure>
                        <p>
                        </p>
                    </details>

                    <details>
                        <summary class="sum2">
                        17.9.5 List use
                        </summary>
                        <figure>
                            <img src="" width="40%">
                            <figcaption>
                            </figcaption>
                        </figure>
                        <p>
                        </p>
                    </details>

                </details>

                <details>
                    <summary class="sum1">
                    17.10 The this pointer
                    </summary>
                    <figure>
                        <img src="" width="40%">
                        <figcaption>
                        </figcaption>
                    </figure>
                    <p>
                    </p>
                    <details>
                        <summary class="sum2">
                        17.10.1 More link use
                        </summary>
                        <figure>
                            <img src="" width="40%">
                            <figcaption>
                            </figcaption>
                        </figure>
                        <p>
                        </p>
                    </details>

                </details>


                <details>
                    <summary class="sum1">
                    Test Yourself!
                    </summary>
                    <figure>
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2e/Exams_in_Jaura%2C_India.jpg/560px-Exams_in_Jaura%2C_India.jpg"
                        width="20%">
                        <figcaption>
                        </figcaption>
                    </figure>
<!-- Include the test material here! -->
                </details>


                <details>
                    <summary class="sum1">
                    Drill
                    </summary>
                    <figure>
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/Queens.guard.buck.palace.arp.jpg/600px-Queens.guard.buck.palace.arp.jpg"
                        width="20%">
                        <figcaption>
                        </figcaption>
                    </figure>

                    <ol>
                    </ol>
                </details>

            </div>
        </div>

    </body>
</html>
